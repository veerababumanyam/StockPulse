<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget Persistence Manual Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-step {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .test-step.success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .test-step.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button.success {
            background: #28a745;
        }
        .button.error {
            background: #dc3545;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.pending {
            background: #ffc107;
            color: #212529;
        }
        .status.success {
            background: #28a745;
            color: white;
        }
        .status.error {
            background: #dc3545;
            color: white;
        }
        .dashboard-frame {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üöÄ Widget Persistence Manual Test Suite</h1>

    <div class="test-container">
        <h2>üìã Test Overview</h2>
        <p>This manual test suite will help you verify that widget persistence is working correctly in the StockPulse dashboard.</p>

        <div class="test-step">
            <strong>Prerequisites:</strong>
            <ul>
                <li>Development server running on <a href="http://localhost:3001" target="_blank">http://localhost:3001</a></li>
                <li>Browser developer tools open (F12)</li>
                <li>Console tab visible for debugging logs</li>
            </ul>
        </div>
    </div>

    <div class="test-container">
        <h2>üß™ Test 1: Add Widget Functionality</h2>
        <div id="test1-status" class="status pending">PENDING</div>

        <div class="test-step">
            <strong>Steps:</strong>
            <ol>
                <li>Navigate to <a href="http://localhost:3001/dashboard" target="_blank">Dashboard</a></li>
                <li>Click "Start Customizing" button</li>
                <li>Click "Add Widget" on Portfolio Overview</li>
                <li>Verify widget appears on dashboard</li>
                <li>Check console for debug logs</li>
            </ol>
        </div>

        <div class="test-step">
            <strong>Expected Console Logs:</strong>
            <div class="console-output">
Dashboard: handleAddWidget called with: portfolio-overview
Adding widget: {widgetType: "portfolio-overview", widgetId: "widget-...", newWidget: {...}}
Updated layout: {widgets: [...]}
            </div>
        </div>

        <button class="button" onclick="markTest('test1', 'success')">‚úÖ Test Passed</button>
        <button class="button" onclick="markTest('test1', 'error')">‚ùå Test Failed</button>
    </div>

    <div class="test-container">
        <h2>üîÑ Test 2: Widget Persistence</h2>
        <div id="test2-status" class="status pending">PENDING</div>

        <div class="test-step">
            <strong>Steps:</strong>
            <ol>
                <li>Add 2-3 different widgets to dashboard</li>
                <li>Exit edit mode</li>
                <li>Refresh the page (F5 or Ctrl+R)</li>
                <li>Verify all widgets are still there</li>
                <li>Check that layout positions are preserved</li>
            </ol>
        </div>

        <div class="test-step">
            <strong>Expected Behavior:</strong>
            <ul>
                <li>Widgets persist after page reload</li>
                <li>Layout positions are maintained</li>
                <li>No duplicate widgets appear</li>
            </ul>
        </div>

        <button class="button" onclick="markTest('test2', 'success')">‚úÖ Test Passed</button>
        <button class="button" onclick="markTest('test2', 'error')">‚ùå Test Failed</button>
    </div>

    <div class="test-container">
        <h2>üî¢ Test 3: Multiple Widgets of Same Type</h2>
        <div id="test3-status" class="status pending">PENDING</div>

        <div class="test-step">
            <strong>Steps:</strong>
            <ol>
                <li>Add a Portfolio Overview widget</li>
                <li>Add another Portfolio Overview widget</li>
                <li>Verify both widgets appear</li>
                <li>Check that they have different IDs in console</li>
            </ol>
        </div>

        <div class="test-step">
            <strong>Expected Console Logs:</strong>
            <div class="console-output">
Adding widget: {widgetType: "portfolio-overview", widgetId: "widget-123-abc", ...}
Adding widget: {widgetType: "portfolio-overview", widgetId: "widget-456-def", ...}
            </div>
        </div>

        <button class="button" onclick="markTest('test3', 'success')">‚úÖ Test Passed</button>
        <button class="button" onclick="markTest('test3', 'error')">‚ùå Test Failed</button>
    </div>

    <div class="test-container">
        <h2>üóëÔ∏è Test 4: Remove Widget</h2>
        <div id="test4-status" class="status pending">PENDING</div>

        <div class="test-step">
            <strong>Steps:</strong>
            <ol>
                <li>Enter edit mode</li>
                <li>Click X button on a widget</li>
                <li>Verify widget is removed immediately</li>
                <li>Exit edit mode</li>
                <li>Refresh page to verify removal persisted</li>
            </ol>
        </div>

        <div class="test-step">
            <strong>Expected Behavior:</strong>
            <ul>
                <li>Widget disappears immediately</li>
                <li>Layout adjusts automatically</li>
                <li>Removal persists after page reload</li>
            </ul>
        </div>

        <button class="button" onclick="markTest('test4', 'success')">‚úÖ Test Passed</button>
        <button class="button" onclick="markTest('test4', 'error')">‚ùå Test Failed</button>
    </div>

    <div class="test-container">
        <h2>üíæ Test 5: Auto-Save Functionality</h2>
        <div id="test5-status" class="status pending">PENDING</div>

        <div class="test-step">
            <strong>Steps:</strong>
            <ol>
                <li>Add a widget (auto-enables edit mode)</li>
                <li>Exit edit mode</li>
                <li>Watch console for auto-save logs</li>
                <li>Verify "Auto-save completed successfully" message</li>
            </ol>
        </div>

        <div class="test-step">
            <strong>Expected Console Logs:</strong>
            <div class="console-output">
Auto-save effect triggered: {isEditMode: false, hasUnsavedChanges: true}
Auto-saving layout...
Auto-save completed successfully
            </div>
        </div>

        <button class="button" onclick="markTest('test5', 'success')">‚úÖ Test Passed</button>
        <button class="button" onclick="markTest('test5', 'error')">‚ùå Test Failed</button>
    </div>

    <div class="test-container">
        <h2>üìä Test Results Summary</h2>
        <div id="results-summary">
            <p>Complete all tests above to see the summary.</p>
        </div>

        <button class="button" onclick="generateReport()">üìã Generate Test Report</button>
        <button class="button" onclick="resetTests()">üîÑ Reset All Tests</button>
    </div>

    <div class="test-container">
        <h2>üîß Debugging Tips</h2>
        <div class="test-step">
            <strong>If widgets are not persisting:</strong>
            <ul>
                <li>Check browser console for errors</li>
                <li>Verify network requests in Network tab</li>
                <li>Check if localStorage is working</li>
                <li>Look for "saveLayout" function calls</li>
            </ul>
        </div>

        <div class="test-step">
            <strong>If widgets are not appearing:</strong>
            <ul>
                <li>Check if "addWidget" function is called</li>
                <li>Verify widget library modal opens</li>
                <li>Look for JavaScript errors in console</li>
                <li>Check if edit mode is enabled</li>
            </ul>
        </div>
    </div>

    <script>
        const testResults = {
            test1: 'pending',
            test2: 'pending',
            test3: 'pending',
            test4: 'pending',
            test5: 'pending'
        };

        function markTest(testId, status) {
            testResults[testId] = status;
            const statusElement = document.getElementById(testId + '-status');
            statusElement.className = `status ${status}`;
            statusElement.textContent = status.toUpperCase();

            updateResultsSummary();
        }

        function updateResultsSummary() {
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(r => r === 'success').length;
            const failed = Object.values(testResults).filter(r => r === 'error').length;
            const pending = Object.values(testResults).filter(r => r === 'pending').length;

            const summaryElement = document.getElementById('results-summary');
            summaryElement.innerHTML = `
                <h3>Test Results:</h3>
                <p>‚úÖ Passed: ${passed}/${total}</p>
                <p>‚ùå Failed: ${failed}/${total}</p>
                <p>‚è≥ Pending: ${pending}/${total}</p>
                <p><strong>Overall Status: ${pending === 0 ? (failed === 0 ? 'üéâ ALL TESTS PASSED!' : '‚ö†Ô∏è SOME TESTS FAILED') : '‚è≥ TESTS IN PROGRESS'}</strong></p>
            `;
        }

        function generateReport() {
            const report = {
                timestamp: new Date().toISOString(),
                results: testResults,
                summary: {
                    total: Object.keys(testResults).length,
                    passed: Object.values(testResults).filter(r => r === 'success').length,
                    failed: Object.values(testResults).filter(r => r === 'error').length,
                    pending: Object.values(testResults).filter(r => r === 'pending').length
                }
            };

            console.log('üöÄ Widget Persistence Test Report:', report);
            alert('Test report generated! Check browser console for details.');
        }

        function resetTests() {
            Object.keys(testResults).forEach(testId => {
                testResults[testId] = 'pending';
                const statusElement = document.getElementById(testId + '-status');
                statusElement.className = 'status pending';
                statusElement.textContent = 'PENDING';
            });
            updateResultsSummary();
        }

        // Initialize
        updateResultsSummary();
    </script>
</body>
</html>
